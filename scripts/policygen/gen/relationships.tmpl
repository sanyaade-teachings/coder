type Obj{{ capitalize .Name }} struct {
	Obj *v1.ObjectReference
	Relationships []v1.Relationship
}

func {{ capitalize .Name }}(id string) *Obj{{ capitalize .Name }} {
	o := &Obj{{ capitalize .Name }}{
		Obj: &v1.ObjectReference{
			ObjectType: "{{ .Name }}",
			ObjectId:   id,
		},
		Relationships: []v1.Relationship{},
	}
	return o
}

{{ $outerName := .Name }}
func (obj *Obj{{ capitalize $outerName }}) Type() string {
	return "{{ .Name }}"
}

func (obj *Obj{{ capitalize $outerName }}) Object() *v1.ObjectReference {
	return obj.Obj
}

{{ range $index, $element := .DirectRelations }}
{{/* Wildcard '*' is a keyword for spicedb to represent 'all objects of this type' */}}
{{ if eq $element.Subject.Object.ObjectId "*" }}
func (obj *Obj{{ capitalize $outerName }}) {{ capitalize $element.RelationName }}Wildcard() *Obj{{ capitalize $outerName }}{
	obj.Relationships = append(obj.Relationships, v1.Relationship{
		Resource: obj.Obj,
		Relation: "{{ $element.RelationName }}",
		Subject: &v1.SubjectReference{
			Object: &v1.ObjectReference {
				ObjectType: "{{ $element.Subject.Object.ObjectType }}",
				ObjectId: "*",
			},
			OptionalRelation: "{{ $element.Subject.OptionalRelation }}",
		},
		OptionalCaveat: nil,
	})
	return obj
}

{{ else }}

func (obj *Obj{{ capitalize $outerName }}) {{ capitalize $element.FunctionName }}(subs ...*Obj{{ capitalize $element.Subject.Object.ObjectType }}) *Obj{{ capitalize $outerName }}{
	for i := range subs {
		sub := subs[i]
		obj.Relationships = append(obj.Relationships, v1.Relationship{
			Resource: obj.Obj,
			Relation: "{{ $element.RelationName }}",
			Subject: &v1.SubjectReference{
				Object: sub.Obj,
				OptionalRelation: "{{ $element.Subject.OptionalRelation }}",
			},
			OptionalCaveat: nil,
		})
	}
	return obj
}
{{ end }}
{{ end }}
